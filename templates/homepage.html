{% extends 'base.html' %}

{% block title %} {% endblock %}

{% block content %}

<div class="recommendation">
  <h2>Up Next:</h2>
  {% for event in events_today %}
    <p>
      Event #{{ event.wear_event_id }} - {{ event.name }}
    </p>

    <div class="outfit-frame">
    {% if event.outfit %}
      <fieldset>
      <legend>Outfit - 
      {% if event.outfit.name %}
        {{ event.outfit.name }}
      {% else %}
        # {{ event.outfit_id }}
      {% endif %}
      </legend>

      <!-- Iterate over all articles in the event (via the outfit) & display them. -->
      {% for article in event.outfit.articles %}
        <div class="articles-block block-bucket">
          <a href="/articles/{{ article.article_id }}">
            <img src="{{ article.image }}" class="article-image">
          </a>
        </div>
      {% endfor %}
      </fieldset>
    {% else %}
      <fieldset>
      <legend>Recommended Outfit - 
      {% if outfit_recs[0][event].name %}
        {{ outfit_recs[0][event].name }}
      {% else %}
        # {{ outfit_recs[0][event].outfit_id }}
      {% endif %}
      </legend>

      <!-- Iterate over all articles in the event (via the outfit) & display them. -->
      {% for article in outfit_recs[0][event].articles %}
        <div class="articles-block block-bucket">
          <a href="/articles/{{ article.article_id }}">
            <img src="{{ article.image }}" class="article-image">
          </a>
        </div>
      {% endfor %}
      <form action="/update-event" method="POST">
        <input type="hidden" name="event-to-edit" value="{{ event.wear_event_id }}">
        <input type="hidden" name="event-outfit" value="{{ outfit_recs[0][event].outfit_id }}">
        <input type="submit" value="Wear this!">
      </form>
      <form action="/update-event" method="POST">
        <input type="hidden" name="event-to-edit" value="{{ event.wear_event_id }}">
        <label for="event-outfit">Choose a different outfit:</label>
        <select name="event-outfit" id="event-outfit-select">
          {% for outfit in outfits %}
            <option value="{{ outfit.outfit_id }}">
              {% if outfit.name %}
                {{ outfit.name }}
              {% else %}
                Outfit # {{ outfit.outfit_id }}
              {% endif %}
            </option>
          {% endfor %}
        </select>
        <input type="submit" value="Wear something else">
      </form>
      </fieldset>
    {% endif %}
    </div>
  {% endfor %}

</div>

<section name="statistics">
  <div id="total-articles" class="inline-block">
    <h1>{{ user_stats['counts']['articles'] }}</h1>
    <p>| articles |</p>
  </div>
  <div id="total-outfits" class="inline-block">
    <h1>{{ user_stats['counts']['outfits'] }}</h1>
    <p>| outfits |</p>
  </div>
  <div id="total-events" class="inline-block">
    <h1>{{ user_stats['counts']['events'] }}</h1>
    <p>| events |</p>
  </div>
  <div id="total-categories" class="inline-block">
    <h1>{{ user_stats['counts']['categories'] }}</h1>
    <p>| categories |</p>
  </div>
  {% if user_stats['most_worn'].get('outfit') %}
    <div id="most-worn-outfit" class="inline-block">
      <h1><a href="/outfits/{{ user_stats['most_worn']['outfit'].outfit_id }}">#{{ user_stats['most_worn']['outfit'].outfit_id }}</a></h1>
      <p>| most worn outfit |<br />
      | worn {{ user_stats['most_worn']['outfit'].times_worn }} times |</p>
    </div>
  {% endif %}
  {% if user_stats['most_worn'].get('article') %}
    <div id="most-worn-article" class="inline-block">
      <a href="/articles/{{ user_stats['most_worn']['article'].article_id }}"><img src="{{ user_stats['most_worn']['article'].image }}" class="thumbnail" /></a>
      <p>| most worn article |<br />
      | worn {{ user_stats['most_worn']['article'].times_worn }} times |</p>
    </div>
  {% endif %}
  {% if user_stats['most_worn'].get(random_category) %}
    <div id="most-worn-category-article" class="inline-block">
      <a href="/articles/{{ user_stats['most_worn'][random_category.name].article_id }}"><img src="{{ user_stats['most_worn'][random_category.name].image }}" class="thumbnail" /></a>
      <p>| most worn in {{ random_category.name }} |<br />
      | worn {{ user_stats['most_worn'][random_category.name].times_worn }} times |</p>
    </div>
  {% endif %}
  {% if user_stats['best_value'].get('nonzero_outfit') %}
    <div id="best-value-outfit" class="inline-block">
      <h1><a href="/outfits/{{ user_stats['best_value']['nonzero_outfit'].outfit_id }}">#{{ user_stats['best_value']['nonzero_outfit'].outfit_id }}</a></h1>
      <p>| best value outfit |<br />
      {# Jinja doesn't seem to support f-string formatting :( #}
      | {{ '$%.2f'|format(user_stats['best_value']['nonzero_outfit'].value) }} per wear |</p>
    </div>
  {% endif %}
  {% if user_stats['best_value'].get('nonzero_article') %}
    <div id="best-value-article" class="inline-block">
      <h1><a href="/articles/{{ user_stats['best_value']['nonzero_article'].article_id }}"><img src="{{ user_stats['best_value']['nonzero_article'].image }}" class="thumbnail"></a></h1>
      <p>| best value article |<br />
      | {{ '$%.2f'|format(user_stats['best_value']['nonzero_article'].value) }} per wear |</p>
    </div>
  {% endif %}
  {% if user_stats['most_used'].get(random_tag) %}
    <div id="most-used-tag" class="inline-block">
      <h1>{{ user_stats['most_used'][random_tag]['tag'].name }}</h1>
      <p>| favorite {{ random_tag }} tag |<br />
      | {{ user_stats['most_used'][random_tag]['count'] }} uses |</p>
    </div>
  {% endif %}
</section>

<button class="block-bucket">
  <a href="/outfits">
    Outfits
  </a>
</button>

<button class="block-bucket">
  <a href="/articles">
    Articles
  </a>
</button>

<button class="block-bucket">
  <a href="/categories">
    Categories
  </a>
</button>

<button class="block-bucket">
  <a href="/events">
    Events (Logs)
  </a>
</button>

<form action="/get-weather" id="get-weather">
    <label for="city">City:</label>
    <input type="text" name="city">
    <input type="submit" value="Get Weather">
</form>

{% for hour in hourly[:5:1] %}
  <div class="forecast">
    <img src="https://darksky.net/images/weather-icons/{{ hour['icon'] }}.png" class="forecast" />
    <h3>{{ hour['temperature'] }}&deg;</h3>
    {{ hour.datestr }} - {{ hour['summary'] }}
  </div>
{% endfor %}

{% for day in daily[1:2] %}
<div class="forecast tomorrow">
  <img src="https://darksky.net/images/weather-icons/{{ day['icon'] }}.png" class="forecast" />
  <h3>{{ day.apparentTemperatureLow }}&deg; - {{ day.apparentTemperatureHigh }}&deg;</h3>
  {{ day.datestr }} - {{ day['summary'] }}
</div>
{% endfor %}

<div class="weather-forecast">
    <div class="weather-forecast today" id="forecast-today">
    </div>
    <div class="weather-forecast tomorrow" id="forecast-tomorrow">
    </div>
</div>

<script>
    "use strict";

    const updateWeather = (res) => {
        $('#forecast-today').html(res.main['temp']);
    };

    $('#get-weather').on('submit', (evt) => {
        evt.preventDefault();

        const city = $('city').val();

        // parameters = {
        //     'async': true,
        //     'crossDomain': true,
        //     'url': `https://community-open-weather-map.p.rapidapi.com/weather?units=imperial&q=${city}`,
        //     'method': 'GET',
        //     'headers': {
        //         'x-rapidapi-host': 'community-open-weather-map.p.rapidapi.com',
        //         'x-rapidapi-key': '225deb2e85a9e0632762551be777b883'
        //     }
        // }

        // $.ajax(parameters.done(updateWeather));
    });

</script>


{% endblock%}